# ./github/workflows/security-scan.yml
name: Terraform Security Scan (Trivy + tfsec)

on:
  workflow_dispatch: {}
  push:
  #   branches: [ main ]
  #   paths:
  #     - '**/*.tf'
  #     - '**/*.tfvars'
  # pull_request:
  #   branches: [ main ]
  #   paths:
  #     - '**/*.tf'
  #     - '**/*.tfvars'

  # Weekly scan â€“ with Rocket.Chat alert
  schedule:
    - cron: '0 2 * * 1'  # every Monday 02:00 UTC

permissions:
  contents: read
  actions: read # fingerprinting
  issues: write  # uto-issue creation
  security-events: write #sarif upload

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Full Security Scan
        uses: ./.github/actions/terraform-security-scan
        with:
            environment: dev
            tfvars-file: dev.tfvars
            backend-file: dev.backend.tfvars